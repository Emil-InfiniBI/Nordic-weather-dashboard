<!DOCTYPE html>
<html>
<head>
  <title>PWA Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #1e2937; color: white; }
    .status { padding: 10px; margin: 10px 0; border-radius: 8px; }
    .pass { background: #10b981; }
    .fail { background: #ef4444; }
    button { padding: 12px 24px; font-size: 16px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; margin: 10px 5px; }
    button:hover { background: #2563eb; }
  </style>
</head>
<body>
  <h1>üîç PWA Configuration Test</h1>
  <div id="results"></div>
  <button onclick="testInstall()">Test Install Prompt</button>
  <button onclick="location.reload()">Refresh</button>
  
  <script>
    const results = document.getElementById('results');
    
    function addResult(name, pass, message) {
      const div = document.createElement('div');
      div.className = 'status ' + (pass ? 'pass' : 'fail');
      div.innerHTML = `<strong>${pass ? '‚úì' : '‚úó'} ${name}</strong><br>${message}`;
      results.appendChild(div);
    }
    
    // Test manifest
    fetch('/manifest.json')
      .then(r => r.json())
      .then(data => {
        addResult('Manifest', true, `Found: ${data.name} (${data.short_name})`);
      })
      .catch(e => addResult('Manifest', false, 'Not found: ' + e.message));
    
    // Test service worker
    if ('serviceWorker' in navigator) {
      addResult('Service Worker Support', true, 'Browser supports service workers');
      navigator.serviceWorker.getRegistrations().then(regs => {
        if (regs.length > 0) {
          addResult('Service Worker Registration', true, `${regs.length} worker(s) registered`);
        } else {
          addResult('Service Worker Registration', false, 'No workers registered yet - reload page');
        }
      });
    } else {
      addResult('Service Worker Support', false, 'Not supported');
    }
    
    // Test icons
    fetch('/icon-192.png').then(r => {
      addResult('Icon 192x192', r.ok, r.ok ? 'Found' : 'Missing');
    });
    fetch('/icon-512.png').then(r => {
      addResult('Icon 512x512', r.ok, r.ok ? 'Found' : 'Missing');
    });
    
    // Test HTTPS/secure context
    addResult('Secure Context', window.isSecureContext, 
      window.isSecureContext ? 'HTTPS or localhost' : 'WARNING: PWA requires HTTPS');
    
    // Test install capability
    window.addEventListener('beforeinstallprompt', (e) => {
      window.deferredPrompt = e;
      addResult('Install Prompt', true, 'Available - click "Test Install" button');
    });
    
    function testInstall() {
      if (window.deferredPrompt) {
        window.deferredPrompt.prompt();
        window.deferredPrompt.userChoice.then(choice => {
          addResult('Install Choice', true, `User ${choice.outcome}`);
        });
      } else {
        alert('Install prompt not available. Either:\n1. App already installed\n2. Page needs reload\n3. Not on mobile device');
      }
    }
    
    setTimeout(() => {
      if (!window.deferredPrompt) {
        addResult('Install Prompt', false, 'Not triggered (may already be installed or not on mobile)');
      }
    }, 2000);
  </script>
</body>
</html>
